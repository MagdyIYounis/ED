/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * @ignore
 */
define(["text!../variable.json","accUtils","ojs/ojanimation","knockout","ojs/ojbootstrap","jquery","ojs/ojresponsiveutils","ojs/ojresponsiveknockoututils","ojs/ojasyncvalidator-regexp","ojs/ojmessaging","ojs/ojarraydataprovider","ojs/ojlistdataproviderview","ojs/ojknockout-keyset","ojs/ojknockout","ojs/ojinputtext","ojs/ojlabel","ojs/ojformlayout","ojs/ojselectcombobox","ojs/ojinputnumber","ojs/ojtable","ojs/ojmessages","ojs/ojpopup","ojs/ojgauge"],(function(e,t,r,o,s,i,a,n,u,l,m,h,d){return function(){var s=this;this.val_Country=o.observable(""),this.NameCustomer=o.observable(""),this.Code_Cust=o.observable("0000"),this.Code_Cust_Search=o.observable(""),this.Phone_Search=o.observable(""),this.District_Number=o.observable(0),this.Neighboring_Number=o.observable(0),this.Block_Number=o.observable(0),this.Floor_Number=o.observable(0),this.Flat_Number=o.observable(0),this.info=o.observable(""),this.Phone=o.observableArray(""),this.error_Phone=o.observableArray([]),this.dataprovider=o.observable(),this.Country_Op=o.observable(""),this.val_City=o.observable(""),this.City_Op=o.observable(""),this.button2Text=o.observable("Save"),this.Disable=o.observable(""),this.messagesDataprovider=o.observableArray([]);var b=[];this.selectedRows=o.observable(),this.selectedColumns=new d.ObservableKeySet,this.isSmall=n.createMediaQueryObservable(a.getFrameworkQuery(a.FRAMEWORK_QUERY_KEY.SM_ONLY)),this.isLargeOrUp=n.createMediaQueryObservable(a.getFrameworkQuery(a.FRAMEWORK_QUERY_KEY.LG_UP)),this.columns=o.computed((function(){return this.isLargeOrUp()?3:2}),this),this.labelEdge=o.computed((function(){return this.isSmall()?"top":"start"}),this),this.clear=()=>{this.Code_Cust("0000"),this.NameCustomer(""),this.District_Number(0),this.Neighboring_Number(0),this.Block_Number(0),this.Floor_Number(0),this.Flat_Number(0),this.info(""),this.val_City(""),this.Phone([]),c(),this.button2Text("Save")},this.valueChangeHandler=function(e){if("valueChanged"===e.type&&("enter_pressed"===e.detail.trigger||"blur"===e.detail.trigger)){var t=e.detail.value,r=t[t.length-1];new RegExp("[0]{1}[1]{1}[0-5]{1}[0-9]{8}").test(r)||(e.detail.value.pop(),document.getElementById("Phone").refresh(),b.push({summary:"Error",detail:"This NumberPhone is correct",severity:l.SEVERITY_LEVEL.ERROR}),this.error_Phone(b),document.getElementById("Phone").focus())}}.bind(this);var c=(t,r)=>{if(null!=t&&""!=t||null!=r&&""!=r)if(null==t||""==t){var o={url:JSON.parse(e).url+"/api/phone_numbers?filter[where][Phone_Number]="+r,method:"GET",timeout:0,headers:{"Content-Type":"application/json"}};i.ajax(o).done((function(e){c(e[0].customerId)}))}else{o={url:JSON.parse(e).url+"/api/customer_vs/"+t+"?filter[order]=Cust_ID%20DESC",method:"GET",timeout:0,headers:{"Content-Type":"application/json"}};i.ajax(o).done((function(e){s.dataprovider(new m([e],{keyAttributes:"Cust_ID",implicitSort:[{attribute:"Cust_ID",direction:"ascending"}]}))}))}else i.getJSON(JSON.parse(e).url+"/api/customer_vs?filter[order]=Date%20DESC").then((function(e){s.dataprovider(new m(e,{keyAttributes:"Cust_ID",implicitSort:[{attribute:"Cust_ID",direction:"ascending"}]}))}))};this.clear();var p={mapFields:function(e){var t=e.data,r={data:{}};return r.data.label=t.Country_Name,r.data.value=t.Country_ID,r.metadata={key:t.Country_ID},r}};i.getJSON(JSON.parse(e).url+"/api/countries").then(async e=>{var t=new m(e,{keyAttributes:"Country_ID"});this.Country_Op(new h(t,{dataMapping:p})),this.val_Country(1)});var _={mapFields:function(e){var t=e.data,r={data:{}};return r.data.label=t.City_Name,r.data.value=t.City_ID,r.metadata={key:t.City_ID},r}};this.valueChangeCountry=function(t){i.getJSON(JSON.parse(e).url+"/api/countries/"+this.val_Country()+"/cities").then(e=>{var t=new m(e,{keyAttributes:"City_ID"});s.City_Op(new h(t,{dataMapping:_}))})}.bind(this),this.valid_Name=o.observableArray([new u({pattern:"^[ء-ي٠-٩ ]+$",hint:"enter two words with a space between it.",messageDetail:"messageDetailString"})]);var v=[];this.Save=(t,r,o)=>{if(this.Disable("true"),"valid"!=NameCustomer.valid)return this.messagesDataprovider.push({severity:"error",summary:"Name",detail:"The Name is invalid",autoTimeout:parseInt(0,10)}),!0;if("valid"!=i("#Governorate")[0].valid)return this.messagesDataprovider.push({severity:"error",summary:"Country",detail:"The Country is invalid",autoTimeout:parseInt(0,10)}),!0;if("valid"!=i("#City")[0].valid)return this.messagesDataprovider.push({severity:"error",summary:"City",detail:"The City is invalid",autoTimeout:parseInt(0,10)}),!0;if("valid"!=i("#Phone")[0].valid)return this.messagesDataprovider.push({severity:"error",summary:"Phone",detail:"The Phone is invalid",autoTimeout:parseInt(0,10)}),!0;if("Save"==s.button2Text()){var a={url:JSON.parse(e).url+"/api/Customers?access_token="+sessionStorage.getItem("ID"),method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({Cust_Name:this.NameCustomer(),District_Number:this.District_Number(),Neighboring_Number:this.Neighboring_Number(),Block_Number:this.Block_Number(),Floor_Number:this.Floor_Number(),Flat_Number:this.Flat_Number(),Info:this.info(),Point:0,cityId:this.val_City()})};i.ajax(a).done((function(t){v=[],s.Phone().forEach(e=>{v.push({Phone_Number:e,customerId:t.Cust_ID})});var r={url:JSON.parse(e).url+"/api/phone_numbers?access_token="+sessionStorage.getItem("ID"),method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify(v)};i.ajax(r).done((function(e){s.messagesDataprovider.push({severity:"confirmation",summary:t.Cust_ID,detail:"Confirmation Add New Customer",autoTimeout:parseInt(0,10)}),s.clear()}))}))}else{a={url:JSON.parse(e).url+"/api/Customers/"+this.Code_Cust()+"?access_token="+sessionStorage.getItem("ID"),method:"PUT",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({Cust_Name:this.NameCustomer(),District_Number:this.District_Number(),Neighboring_Number:this.Neighboring_Number(),Block_Number:this.Block_Number(),Floor_Number:this.Floor_Number(),Flat_Number:this.Flat_Number(),Info:this.info(),cityId:this.val_City()})};i.ajax(a).done((function(t){var r={url:JSON.parse(e).url+"/api/Customers/"+s.Code_Cust()+"/phoneNumbers?access_token="+sessionStorage.getItem("ID"),method:"DELETE",timeout:0};i.ajax(r).done((function(t){v=[],s.Phone().forEach(e=>{v.push({Phone_Number:e,customerId:s.Code_Cust()})});var r={url:JSON.parse(e).url+"/api/phone_numbers?access_token="+sessionStorage.getItem("ID"),method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify(v)};i.ajax(r).done((function(e){s.messagesDataprovider.push({severity:"confirmation",summary:s.Code_Cust(),detail:"Confirmation Update Customer",autoTimeout:parseInt(0,10)}),s.clear(),s.Disable("")}))}))}))}this.Disable("")},this.selectedListener=function(t){if("firstSelectedRowChanged"===t.type){var r=t.detail.value.data.Cust_ID;if(s.button2Text("Update"),null!=r){var o={url:JSON.parse(e).url+"/api/Customers/"+r,method:"GET",timeout:0,headers:{"Content-Type":"application/json"}};i.ajax(o).done((function(t){s.Code_Cust(t.Cust_ID),s.NameCustomer(t.Cust_Name),s.District_Number(t.District_Number),s.Neighboring_Number(t.Neighboring_Number),s.Block_Number(t.Block_Number),s.Floor_Number(t.Floor_Number),s.Flat_Number(t.Flat_Number),s.info(t.Info),s.val_City(t.cityId);var r={url:JSON.parse(e).url+"/api/phone_numbers?filter[where][customerId]="+t.Cust_ID,method:"GET",timeout:0,headers:{"Content-Type":"application/json"}};i.ajax(r).done((function(e){var t=[];e.forEach(e=>{t.push(e.Phone_Number)}),s.Phone(t)}))}))}}},this.startAnimationListener=function(e){var t=e.detail;if("popup1"===e.target.id)if("open"===t.action){e.preventDefault();r.slideIn(t.element,{direction:"bottom"}).then(t.endCallback)}else"close"===t.action&&(e.preventDefault(),t.endCallback())},this.openListener=function(){document.getElementById("popup1").open("#btnGo")},this.cancelListener=function(){document.getElementById("popup1").close(),c(s.Code_Cust_Search(),s.Phone_Search()),s.Code_Cust_Search(""),s.Phone_Search("")},this.cancelListener_1=function(){document.getElementById("popup1").close()},s.connected=function(){t.announce("Customers page loaded.","assertive"),document.title="Customers"},s.disconnected=function(){},s.transitionCompleted=function(){}}}));